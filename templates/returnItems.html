{% extends "home.html" %}
{% block content %}

<div class="container text-center">
    <br>
    <h3>Return Items</h3>
    <br>

    <div class="search-container">
    <input id="searchbar" type="text" placeholder="Enter Transaction ID">
    </div>
    <br>
    <button onclick="search_transactions()" class="editButton">Search Transactions <i class="fa fa-search" style="margin-left: 5px;"></i></button>
    <br>
    <br>
  <h3>Return Item from History Below</h3>
  <br>

<script type="text/javascript" src="returnItems.html"></script>

        <div id="wrapper">
            <table cellspacing=1 cellpadding=1 id="mytable">
                <thead>
                    <tr>
                        <th>Product Code</th>
                        <th>Product Name</th>
                        <th>Quantity</th>
                        <th>Time Stamp</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="tbody">
                </tbody>
            </table>
            <br>
            <br>
            <button onclick="submit()" class="greenButton">Submit Changes<i class="fas fa-check-circle" style="margin-left: 5px;"></i></button>
        </div>
        <br>
<script>

    function search_transactions() { 
        let input = document.getElementById('searchbar').value 
        if (input != ""){
            search(String(input));
        }
        else{
           alert("Enter Transaction Id"); 
        } 
    } 

        let sortDirection = false;

        var myArray = [{ "productCode": "123", "productName": "Blue Pens", "quantity": "5", "timeStamp": "21-04-20" },
                       { "productCode": "123", "productName": "300ml Pyrex Flask", "quantity": "6", "timeStamp": "21-04-20" },
                       { "productCode": "678", "productName": "whiteboard", "quantity": "1", "timeStamp": "23-04-20" },
                                                        ];

        function display(input) {
            var length = myArray.length;
            var htmltext = "";

            for (var i = 0; i < length; i++) {
                htmltext += "<tr id='table"+i+"'><td>"
                +myArray[i]['productCode']+
                "</td><td>"
                +myArray[i]['productName']+
                "</td><td>"
                +myArray[i]['quantity']+
                "</td><td>"
                +myArray[i]['timeStamp']+
                "</td><td><button onclick='edit("+i+")'>Edit</button><button onclick='remove("+i+")'>Remove</button></td></tr>";
            }
            document.getElementById("tbody").innerHTML = htmltext;
        }

        function search(input) {
            var length = myArray.length;
            var htmltext = "";

            for (var i = 0; i < length; i++) {
                console.log(myArray[i]);
                console.log("window is searching for "+input);
                if (input == myArray[i]['productCode']) // ISSUE IS HERE WITH i
                {
                    htmltext += "<tr id='table"+i+"'><td>"
                    +myArray[i]['productCode']+
                    "</td><td>"
                    +myArray[i]['productName']+
                    "</td><td>"
                    +myArray[i]['quantity']+
                    "</td><td>"
                    +myArray[i]['timeStamp']+
                    "</td><td><button onclick='edit("+i+")'>Edit</button><button onclick='remove("+i+")'>Remove</button></td></tr>";
                }
                else{alert(input+" is not in database!");}
            }
            document.getElementById("tbody").innerHTML = htmltext;
        }

        function edit(indice) {
            var htmltext = "<tr><td><input id='inputproductCode"+indice+"' type='text' value='"
                +myArray[indice].productCode+

                "'></td><td><input id='inputproductName"+indice+"' type='text' value='"
                +myArray[indice].productName+

                "'></td><td><input id='inputquantity"+indice+"' type='text' value='"
                +myArray[indice].quantity+

                "'></td><td><input id='inputtimeStamp"+indice+"' type='text' value='"
                +myArray[indice].timeStamp+

                "'></td><td><button onclick='save("+indice+")'>Save</button><button onclick='remove("+indice+")'>Remove</button></td></tr>";
            document.getElementById("table"+indice).innerHTML = htmltext;
        }


        function save(indice) {
            var values = new Array();

            //myArray[indice].productCode = document.getElementById("inputproductCode"+indice).value;
            values.push("'" + myArray[indice].productCode[0].value + "'");

            //myArray[indice].productName = document.getElementById("inputproductName"+indice).value;
            values.push("'" + myArray[indice].productName + "'");

            myArray[indice].quantity = document.getElementById("inputquantity"+indice).value;
            values.push("'" + myArray.quantity + "'");
            
            myArray[indice].timeStamp = document.getElementById("inputtimeStamp"+indice).value;
            values.push("'" + myArray.timeStamp + "'");

            console.log(values);
            /*push to database here*/

            var htmltext = "<tr id='table"+indice+"'><td>"
                +myArray[indice].productCode+
                "</td><td>"
                +myArray[indice].productName+
                "</td><td>"
                +myArray[indice].quantity+
                "</td><td>"
                +myArray[indice].timeStamp+
                "</td><td><button onclick='edit("
                +indice+")'>Edit</button><button onclick='remove("
                +indice+")'>Remove</button></td></tr>";
            document.getElementById("table"+indice).innerHTML = htmltext;
        }


        function remove(indice) {
            console.log(myArray);
            myArray.splice(indice, 1);
            let input = document.getElementById('searchbar').value
            if (input != "") {
                search_transactions()
            } else {
                display()
            }
        }

        function submit() {
            console.log(myArray);
            myArray.splice(indice, 1);
            display();
        }
        
    </script>
</div>
{% endblock %}